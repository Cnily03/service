var params=URLSearchParams&&new URLSearchParams(document.location.search.substring(1)),url=params&&params.get("url")&&decodeURIComponent(params.get("url"));console.log(url);var currentSectionIndex=params&&params.get("loc")?params.get("loc"):void 0;let blob=fetch(url).then(e=>e.blob());var book=ePub(blob.then(e=>e.arrayBuffer()),{restore:!0,reload:!0,spreads:!0}),rendition=book.renderTo("viewer",{width:"100%",height:600,spread:"always"});rendition.display(currentSectionIndex),book.ready.then(function(){document.getElementById("next").addEventListener("click",function(e){"rtl"===book.package.metadata.direction?rendition.prev():rendition.next(),e.preventDefault()},!1),document.getElementById("prev").addEventListener("click",function(e){"rtl"===book.package.metadata.direction?rendition.next():rendition.prev(),e.preventDefault()},!1);var e=function(e){37==(e.keyCode||e.which)&&("rtl"===book.package.metadata.direction?rendition.next():rendition.prev()),39==(e.keyCode||e.which)&&("rtl"===book.package.metadata.direction?rendition.prev():rendition.next())};rendition.on("keyup",e),document.addEventListener("keyup",e,!1)});var title=document.getElementById("title");rendition.on("rendered",function(e){var t=book.navigation&&book.navigation.get(e.href);if(t){var n=document.getElementById("toc"),i=n.querySelector("option[selected]");i&&i.removeAttribute("selected");for(var r=n.querySelectorAll("option"),o=0;o<r.length;++o)r[o].getAttribute("ref")===t.href&&r[o].setAttribute("selected","")}}),rendition.on("relocated",function(e){console.log(e);var t="rtl"===book.package.metadata.direction?document.getElementById("prev"):document.getElementById("next"),n="rtl"===book.package.metadata.direction?document.getElementById("next"):document.getElementById("prev");e.atEnd?t.style.visibility="hidden":t.style.visibility="visible",e.atStart?n.style.visibility="hidden":n.style.visibility="visible"}),rendition.on("layout",function(e){let t=document.getElementById("viewer");e.spread?t.classList.remove("single"):t.classList.add("single")}),window.addEventListener("unload",function(){console.log("unloading"),this.book.destroy()}),book.loaded.navigation.then(function(e){var t=document.getElementById("toc"),n=document.createDocumentFragment();e.forEach(function(e){var t=document.createElement("option");t.textContent=e.label,t.setAttribute("ref",e.href),n.appendChild(t)}),t.appendChild(n),t.onchange=function(){var e=t.selectedIndex,n=t.options[e].getAttribute("ref");return rendition.display(n),!1}});